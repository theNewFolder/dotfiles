#!/bin/sh

# Displays number of upgradeable packages on Void Linux via xbps.

btn="${BUTTON:-${BLOCK_BUTTON:-0}}"
updates_raw="$(xbps-install -Mun 2>/dev/null || true)"
count="$(printf "%s\n" "$updates_raw" | awk 'NF{c++} END{print c+0}')"
updates_pretty="$(printf "%s\n" "$updates_raw" | awk 'NF{print $1}' | sed -n '1,20p')"

case "$btn" in
	1) setsid -f "$TERMINAL" -e sb-popupgrade ;;
	2)
		if [ "$count" -gt 0 ]; then
			notify-send "ðŸ“¦ Upgradeable packages ($count)" "$updates_pretty"
		else
			notify-send "ðŸ“¦ Upgradeable packages" "System is up to date."
		fi
		;;
	3) notify-send "ðŸ“¦ Upgrade module" "Shows number of upgradeable xbps packages.
- Left click: open upgrade terminal
- Middle click: show package list" ;;
	6) setsid -f "$TERMINAL" -e "$EDITOR" "$0" ;;
esac

[ "$count" -gt 0 ] && printf "ðŸ“¦%s\n" "$count"
