#!/bin/sh

# backlight source (first available)
set -- /sys/class/backlight/*
if [ ! -e "$1" ]; then
	echo "ğŸ’¡ --"
	exit 0
fi
bl="$1"

curr_brightness="$(cat "$bl/brightness" 2>/dev/null || echo 0)"
max_brightness="$(cat "$bl/max_brightness" 2>/dev/null || echo 1)"
[ "$max_brightness" -gt 0 ] || max_brightness=1

# brightness percentage
brightness_per=$((100 * curr_brightness / max_brightness))
btn="${BUTTON:-${BLOCK_BUTTON:-0}}"

adjust_brightness() {
	step="$1"
	if command -v brightnessctl >/dev/null 2>&1; then
		brightnessctl set "${step}%" >/dev/null 2>&1
	elif command -v xbacklight >/dev/null 2>&1; then
		case "$step" in
			+*) xbacklight -inc "${step#+}" ;;
			-*) xbacklight -dec "${step#-}" ;;
		esac
	fi
}

case "$btn" in
    1) 
        ;;
    2)
        notify-send "Brightness" "Current: ${brightness_per}%"
        ;;
    3) 
        notify-send "ğŸ’¡ Brightness module" "\- Shows current brightness level â˜€ï¸." 
        ;;
    4)
        adjust_brightness +5
        ;;
    5)
        adjust_brightness -5
        ;;
    6) 
        setsid -f "$TERMINAL" -e "$EDITOR" "$0"
        ;;
esac

echo "ğŸ’¡ ${brightness_per}%"
