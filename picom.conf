# ── Picom v12 — Glassmorphism for dwm ──────────────────────────
# ThinkPad T490 — Intel UHD 620 — XLibre with TearFree
# VSync OFF: XLibre TearFree handles it at driver level

# ── Backend ─────────────────────────────────────────────────────
backend = "glx";
glx-no-stencil = false;
glx-no-rebind-pixmap = true;
use-damage = true;
xrender-sync-fence = true;

# ── VSync ───────────────────────────────────────────────────────
vsync = false;

# ── Shadows ─────────────────────────────────────────────────────
shadow = true;
shadow-radius = 8;
shadow-opacity = 0.6;
shadow-offset-x = -4;
shadow-offset-y = -4;
crop-shadow-to-monitor = true;

shadow-exclude = [
    "name = 'Notification'",
    "class_g = 'Dunst'",
    "class_g = 'dwm'",
    "class_g = 'dmenu'",
    "_GTK_FRAME_EXTENTS@:c",
    "_NET_WM_STATE@:32a *= '_NET_WM_STATE_HIDDEN'"
];

# ── Fading ──────────────────────────────────────────────────────
fading = true;
fade-in-step = 0.04;
fade-out-step = 0.04;
fade-delta = 5;
no-fading-openclose = false;

fade-exclude = [
    "class_g = 'dmenu'"
];

# ── Opacity ─────────────────────────────────────────────────────
inactive-opacity = 1.0;
active-opacity = 1.0;
frame-opacity = 1.0;
inactive-opacity-override = false;

opacity-rule = [
    "85:class_g = 'kitty' && focused",
    "75:class_g = 'kitty' && !focused",
    "85:class_g = 'st-256color' && focused",
    "75:class_g = 'st-256color' && !focused",
    "85:class_g = 'St' && focused",
    "75:class_g = 'St' && !focused",
    "85:class_g = 'dmenu'",
    "95:class_g = 'Emacs' && !focused",
    "100:class_g = 'qutebrowser' && focused",
    "95:class_g = 'qutebrowser' && !focused",
    "100:class_g = 'mpv'",
    "100:fullscreen"
];

# ── Blur ────────────────────────────────────────────────────────
blur: {
    method = "dual_kawase";
    strength = 5;
};

blur-background-exclude = [
    "class_g = 'Firefox'",
    "class_g = 'qutebrowser'",
    "class_g = 'Emacs'",
    "class_g = 'mpv'",
    "window_type = 'dock'",
    "_GTK_FRAME_EXTENTS@:c"
];

# ── Rounded Corners ─────────────────────────────────────────────
corner-radius = 14;

rounded-corners-exclude = [
    "window_type = 'dock'",
    "window_type = 'desktop'",
    "class_g = 'dwm'",
    "class_g = 'dmenu'",
    "class_g = 'Dunst'"
];

# ── Animations (picom v12 native) ──────────────────────────────
animations = ({
    triggers = ["open"];
    preset = "fly-in";
    direction = "up";
    duration = 0.15;
}, {
    triggers = ["close"];
    preset = "fly-in";
    direction = "up";
    duration = 0.15;
    invert = true;
}, {
    triggers = ["show"];
    preset = "slide-in";
    direction = "up";
    duration = 0.18;
}, {
    triggers = ["hide"];
    preset = "slide-out";
    direction = "down";
    duration = 0.18;
}, {
    triggers = ["geometry"];
    preset = "geometry-change";
    duration = 0.15;
});

# ── Performance ─────────────────────────────────────────────────
unredir-if-possible = true;
detect-rounded-corners = true;
detect-client-opacity = true;
detect-transient = true;
use-ewmh-active-win = true;

# ── Window type settings ────────────────────────────────────────
wintypes: {
    tooltip = { fade = true; shadow = true; opacity = 0.9; };
    dock = { shadow = false; clip-shadow-above = true; };
    dnd = { shadow = false; };
    popup_menu = { opacity = 0.9; };
    dropdown_menu = { opacity = 0.9; };
};
